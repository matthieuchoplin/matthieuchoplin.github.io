<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Blog about my developer experience">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Standing on the shoulders of giants</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="http://mattchoplin.com/index.html">
<link rel="icon" href="favicon-16x16.png" sizes="16x16">
<link rel="next" href="index-4.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link rel="stylesheet" type="text/css" href="assets/css/tipuesearch.css">
</head>
<body>
<div id="tipue_search_content" style="margin-left: auto; margin-right: auto; padding: 20px;"></div>



    

        <link rel="prefetch" href="posts/sorting-list-with-two-criteria.html" type="text/html">
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://mattchoplin.com/">

                <span id="blog-title">Standing on the shoulders of giants</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/index.html">Tags</a>
                </li>
<li>
<a href="stories/talks.html">Talks</a>
                </li>
<li>
<a href="rss.xml">RSS feed</a>

                
            </li>
</ul>
<span class="navbar-form pull-left">
    <input type="text" id="tipue_search_input"></span>

            <ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    
<div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/sorting-list-with-two-criteria.html" class="u-url">Sorting list with two criteria</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Matthieu Choplin
            </span></p>
            <p class="dateline"><a href="posts/sorting-list-with-two-criteria.html" rel="bookmark"><time class="published dt-published" datetime="2016-12-11T10:26:07Z" title="2016-12-11 10:26">2016-12-11 10:26</time></a></p>
                <p class="commentline">
        
    <a href="posts/sorting-list-with-two-criteria.html#disqus_thread" data-disqus-identifier="cache/posts/sorting-list-with-two-criteria.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>We want to sort a list of elements with the first element in ascending order and the second element in descending order.</p>
<div class="section" id="using-the-lambda-function">
<h2>Using the lambda function:</h2>
<pre class="code python"><a name="rest_code_e4928a0f7abb4a748b2422c95eac2852-1"></a><span class="n">occurences</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'bat'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'mat'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'cat'</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<a name="rest_code_e4928a0f7abb4a748b2422c95eac2852-2"></a><span class="nb">sorted</span><span class="p">(</span><span class="n">occurences</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</pre>
<p>The -x[1] is for the reversed sort.</p>
<p>By order of priority, we first sort with the 2nd element (x[1]), then with the 1st element (x[0])</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/control-the-screen-brightness-in-ubuntu.html" class="u-url">Control the screen brightness in Ubuntu</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Matthieu Choplin
            </span></p>
            <p class="dateline"><a href="posts/control-the-screen-brightness-in-ubuntu.html" rel="bookmark"><time class="published dt-published" datetime="2016-06-23T23:07:34+01:00" title="2016-06-23 23:07">2016-06-23 23:07</time></a></p>
                <p class="commentline">
        
    <a href="posts/control-the-screen-brightness-in-ubuntu.html#disqus_thread" data-disqus-identifier="cache/posts/control-the-screen-brightness-in-ubuntu.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Controlling the brightness of your screen not working after installing Ubuntu on a laptop equipped with an Intel graphics card?</p>
<p>You can solve that through the Xorg configuration.</p>
<p>First, look at your PCI bus, in order to identify your card:</p>
<pre class="code bash"><a name="rest_code_ade95c47634e4b499f030b0ed7d51a8b-1"></a>$ lspci <span class="p">|</span> grep -i vga
<a name="rest_code_ade95c47634e4b499f030b0ed7d51a8b-2"></a>
<a name="rest_code_ade95c47634e4b499f030b0ed7d51a8b-3"></a>00:02.0 VGA compatible controller: Intel Corporation 2nd Generation Core Processor Family Integrated Graphics Controller <span class="o">(</span>rev 09<span class="o">)</span>
</pre>
<p>That's how it looks on my machine. I am interested in the Intel card, so I need to remember its bus id <em>00:02.0</em>.</p>
<p>Next you need to create the config file:</p>
<pre class="code bash"><a name="rest_code_ee74e2eb63af475bb2831ab7fc19eb47-1"></a>$ sudo nano /usr/share/X11/xorg.conf.d/20-intel.conf
</pre>
<p>and put the following content in, which will tell the xorg driver to use intel_backlight:</p>
<pre class="code bash"><a name="rest_code_3c2718071f884eb5b445972838b70805-1"></a>Section <span class="s2">"Device"</span>
<a name="rest_code_3c2718071f884eb5b445972838b70805-2"></a>        Identifier      <span class="s2">"card0"</span>
<a name="rest_code_3c2718071f884eb5b445972838b70805-3"></a>        Driver          <span class="s2">"intel"</span>
<a name="rest_code_3c2718071f884eb5b445972838b70805-4"></a>        Option          <span class="s2">"Backlight"</span> <span class="s2">"intel_backlight"</span>
<a name="rest_code_3c2718071f884eb5b445972838b70805-5"></a>        BusID           <span class="s2">"PCI:0:2:0"</span>
<a name="rest_code_3c2718071f884eb5b445972838b70805-6"></a>EndSection
</pre>
<p>Please note that the BusID should match.</p>
<p>Save, restart your Xorg:</p>
<ul class="simple">
<li>find which display manager your ubuntu is having with following command:</li>
</ul>
<pre class="code bash"><a name="rest_code_a585ec6bd852452d88cb500cd7e81672-1"></a>$ cat /etc/X11/default-display-manager
</pre>
<ul class="simple">
<li>and, for Ubuntu with LightDM:</li>
</ul>
<pre class="code bash"><a name="rest_code_bf2cfacde4624ede9b5048f5e5e3adc1-1"></a>$ sudo restart lightdm
</pre>
<p>It should then work.</p>
<p>Source:
- <a class="reference external" href="https://float-middle.com/screen-brightness-on-intel-ubuntu-14-04/">https://float-middle.com/screen-brightness-on-intel-ubuntu-14-04/</a>
- <a class="reference external" href="http://askubuntu.com/questions/1220/how-to-restart-x-window-server-from-command-line">http://askubuntu.com/questions/1220/how-to-restart-x-window-server-from-command-line</a></p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/python-testing-with-unittest.html" class="u-url">Python testing with doctest and unittest</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Matthieu Choplin
            </span></p>
            <p class="dateline"><a href="posts/python-testing-with-unittest.html" rel="bookmark"><time class="published dt-published" datetime="2014-11-12T16:02:45+01:00" title="2014-11-12 16:02">2014-11-12 16:02</time></a></p>
                <p class="commentline">
        
    <a href="posts/python-testing-with-unittest.html#disqus_thread" data-disqus-identifier="cache/posts/python-testing-with-unittest.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<div class="section" id="the-problem">
<h2>The problem:</h2>
<p>We want to create a function that is able to determine whether a string is a palindrome.</p>
<p>A palindrome is a word that is read the same from front-to-back and from back-to-front.</p>
<p>For instance, the words "noon" and "racecar" are both palindromes.</p>
</div>
<div class="section" id="algorithm">
<h2>Algorithm:</h2>
<p>Reverse the string.</p>
<p>Compare the reversed string to the original string.</p>
</div>
<div class="section" id="recipe-for-designing-functions">
<h2>Recipe for designing functions:</h2>
<ol class="arabic simple" start="0">
<li>Give the function a name</li>
<li>Examples</li>
<li>Type Contract</li>
<li>Header</li>
<li>Description</li>
<li>Body</li>
<li>Test</li>
</ol>
<p>First, we will see the python module <em>doctest</em> which is good for having an up to date documentation.</p>
<p>But using <em>doctest</em> is not recommended for testing a whole program. This is why we will see the python module <em>unittest</em> which is more relevant.</p>
<p>For more about the cons of using <em>doctest</em>: <a class="reference external" href="http://bemusement.org/narrative-tests">Narrative tests are lousy tests</a> and <a class="reference external" href="http://bemusement.org/doctests-arent-code">Tests are code and doctests are not</a>.</p>
<p>Create the file <em>palindrome.py</em>:</p>
<pre class="code python"><a name="rest_code_ca79bc873add4aea9fdb696246eec374-1"></a><span class="ch">#! /usr/bin/python2.7</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-2"></a>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-3"></a><span class="k">def</span> <span class="nf">is_palindrome</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-4"></a>    <span class="sd">"""(str) -&gt; bool</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-5"></a>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-6"></a><span class="sd">    Return True if and only if s is a palindrome.</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-7"></a>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-8"></a><span class="sd">    &gt;&gt;&gt; is_palindrome('noon')</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-9"></a><span class="sd">    True</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-10"></a><span class="sd">    &gt;&gt;&gt; is_palindrome('racecar')</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-11"></a><span class="sd">    True</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-12"></a><span class="sd">    &gt;&gt;&gt; is_palindrome('dented')</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-13"></a><span class="sd">    False</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-14"></a><span class="sd">    """</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-15"></a>    <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">==</span> <span class="n">s</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-16"></a>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-17"></a><span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-18"></a>    <span class="sd">"""(str) -&gt; str</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-19"></a>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-20"></a><span class="sd">    Return the reversed string.</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-21"></a>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-22"></a><span class="sd">    &gt;&gt;&gt; reverse('hello')</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-23"></a><span class="sd">    'olleh'</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-24"></a><span class="sd">    &gt;&gt;&gt; reverse('a')</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-25"></a><span class="sd">    'a'</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-26"></a><span class="sd">    """</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-27"></a>    <span class="n">rev</span> <span class="o">=</span> <span class="s1">''</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-28"></a>    <span class="c1"># for each character in s, add the character at the beginning of rev.</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-29"></a>    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-30"></a>        <span class="n">rev</span> <span class="o">=</span> <span class="n">char</span> <span class="o">+</span> <span class="n">rev</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-31"></a>    <span class="k">return</span> <span class="n">rev</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-32"></a>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-33"></a><span class="kn">import</span> <span class="nn">doctest</span>
<a name="rest_code_ca79bc873add4aea9fdb696246eec374-34"></a><span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre>
<p>We want to separate the tests from the main program and use the python <em>unittest</em> module.</p>
<p>Create the file test_palindromes.py</p>
<pre class="code python"><a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-1"></a><span class="ch">#! /usr/bin/python2.7</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-2"></a>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-3"></a><span class="kn">import</span> <span class="nn">unittest</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-4"></a><span class="kn">import</span> <span class="nn">palindromes</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-5"></a>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-6"></a>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-7"></a><span class="k">class</span> <span class="nc">TestPalindrome</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-8"></a>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-9"></a>    <span class="k">def</span> <span class="nf">test_is_palindrome_true</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-10"></a>        <span class="n">value</span> <span class="o">=</span> <span class="n">palindromes</span><span class="o">.</span><span class="n">is_palindrome</span><span class="p">(</span><span class="s1">'racecar'</span><span class="p">)</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-12"></a>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-13"></a>    <span class="k">def</span> <span class="nf">test_is_palindrome_false</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-14"></a>        <span class="n">value</span> <span class="o">=</span> <span class="n">palindromes</span><span class="o">.</span><span class="n">is_palindrome</span><span class="p">(</span><span class="s1">'dedent'</span><span class="p">)</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-16"></a>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-17"></a>    <span class="k">def</span> <span class="nf">test_reverse_normal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-18"></a>        <span class="n">value</span> <span class="o">=</span> <span class="n">palindromes</span><span class="o">.</span><span class="n">reverse</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">)</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-19"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">assertEquals</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">'olleh'</span><span class="p">)</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-20"></a>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-21"></a>    <span class="k">def</span> <span class="nf">test_reverse_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-22"></a>        <span class="n">list_of_bad_value</span> <span class="o">=</span> <span class="p">[</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-23"></a>        <span class="mi">123</span><span class="p">,</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-24"></a>        <span class="bp">None</span><span class="p">,</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-25"></a>        <span class="p">]</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-26"></a>        <span class="k">for</span> <span class="n">bad_value</span> <span class="ow">in</span> <span class="n">list_of_bad_value</span><span class="p">:</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-27"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-28"></a>                <span class="ne">TypeError</span><span class="p">,</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-29"></a>                <span class="n">palindromes</span><span class="o">.</span><span class="n">reverse</span><span class="p">,</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-30"></a>                <span class="n">bad_value</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-31"></a>            <span class="p">)</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-32"></a>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-33"></a><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
<a name="rest_code_5414973bdcd4421aaf8a8b25d4dda7b6-34"></a>    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre>
</div>
<div class="section" id="choosing-test-cases-to-test">
<h2>Choosing test cases to test</h2>
<ul class="simple">
<li>Size: For collections, test with an empty collection, a collection with 1 item, the smallest interesting case, and a
collection with several items</li>
<li>Dichotomies: Vowels/Non Vowels, even/odd, positive/negative, empty/full, and so on.</li>
<li>Boundaries: If the function behaves differently for values near a particular threshold, test at that threshold.</li>
<li>Order: If the function behaves differently when the values are in different orders, identify and test each of those
orders.</li>
</ul>
<p>Source: <a class="reference external" href="https://class.coursera.org/programming2-001">https://class.coursera.org/programming2-001</a></p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/context-manager-in-python.html" class="u-url">Context Manager in Python</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Matthieu Choplin
            </span></p>
            <p class="dateline"><a href="posts/context-manager-in-python.html" rel="bookmark"><time class="published dt-published" datetime="2014-10-11T13:50:58+01:00" title="2014-10-11 13:50">2014-10-11 13:50</time></a></p>
                <p class="commentline">
        
    <a href="posts/context-manager-in-python.html#disqus_thread" data-disqus-identifier="cache/posts/context-manager-in-python.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<div class="section" id="the-keyword-with">
<h2>The keyword <em>with</em>
</h2>
<p>The context manager is going to be used with the keyword <em>with</em> such as:</p>
<pre class="code python"><a name="rest_code_a1eb4dfb74d84663844447727da1546d-1"></a><span class="k">with</span> <span class="n">MyContextManager</span> <span class="k">as</span> <span class="n">context_var</span><span class="p">:</span>
<a name="rest_code_a1eb4dfb74d84663844447727da1546d-2"></a>    <span class="c1"># here the statement is going to evaluate the methods</span>
<a name="rest_code_a1eb4dfb74d84663844447727da1546d-3"></a>    <span class="c1"># __enter__ and __exit__ of the class MyContextManager.</span>
<a name="rest_code_a1eb4dfb74d84663844447727da1546d-4"></a>    <span class="c1"># The value returned by __enter__ is going to be assigned</span>
<a name="rest_code_a1eb4dfb74d84663844447727da1546d-5"></a>    <span class="c1"># to the variable "context_var".</span>
</pre>
</div>
<div class="section" id="the-context-manager-can-be-defined-as-a-class">
<h2>The context manager can be defined as a class</h2>
<p>Two essential methods are required for making the class a context manager:</p>
<ul>
<li>
<p class="first"><em>__enter__(self)</em></p>
<p>Defines what the context manager should do at the <strong>beginning of the block</strong> created by the with statement.
Note that the return value of __enter__ is bound to the target of the with statement, or the name after the as.</p>
</li>
<li>
<p class="first"><em>__exit__(self, exception_type, exception_value, traceback)</em></p>
<p>Defines what the context manager should do <strong>after its block has been executed (or terminates)</strong>.
It can be used to handle exceptions, perform cleanup, or do something always done immediately after the action in the block.
If the block executes successfully, exception_type, exception_value, and traceback will be None. Otherwise, you can choose to handle the   exception or let the user handle it; if you want to handle it, make sure __exit__ returns True after all is said and done.
If you don't want the exception to be handled by the context manager, just let it happen.</p>
</li>
</ul>
</div>
<div class="section" id="example">
<h2>Example</h2>
<pre class="code python"><a name="rest_code_53c97a34ecc847d68bac9f8420f743b7-1"></a><span class="k">class</span> <span class="nc">MyContextManager</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<a name="rest_code_53c97a34ecc847d68bac9f8420f743b7-2"></a>    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_53c97a34ecc847d68bac9f8420f743b7-3"></a>        <span class="k">print</span> <span class="s1">'__enter__()'</span>
<a name="rest_code_53c97a34ecc847d68bac9f8420f743b7-4"></a>        <span class="k">return</span> <span class="bp">self</span>
<a name="rest_code_53c97a34ecc847d68bac9f8420f743b7-5"></a>    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception_type</span><span class="p">,</span> <span class="n">exception_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
<a name="rest_code_53c97a34ecc847d68bac9f8420f743b7-6"></a>        <span class="k">print</span> <span class="s1">'__exit__()'</span>
<a name="rest_code_53c97a34ecc847d68bac9f8420f743b7-7"></a>
<a name="rest_code_53c97a34ecc847d68bac9f8420f743b7-8"></a><span class="k">with</span> <span class="n">MyContextManager</span><span class="p">()</span> <span class="k">as</span> <span class="n">context_var</span><span class="p">:</span>
<a name="rest_code_53c97a34ecc847d68bac9f8420f743b7-9"></a>    <span class="k">print</span> <span class="s1">'Doing work in the context'</span>
</pre>
<p>Where the output is:</p>
<pre class="code bash"><a name="rest_code_79b0a71fe346443484eeca4dfb6984ef-1"></a>__enter__<span class="o">()</span>
<a name="rest_code_79b0a71fe346443484eeca4dfb6984ef-2"></a>Doing work in the context
<a name="rest_code_79b0a71fe346443484eeca4dfb6984ef-3"></a>__exit__<span class="o">()</span>
</pre>
</div>
<div class="section" id="the-context-manager-can-also-be-defined-as-a-generator">
<h2>The Context Manager can also be defined as a Generator</h2>
<p>Here, we use the contextlib library and the module contextmanager.</p>
<p>The equivalent of the example above would be:</p>
<pre class="code python"><a name="rest_code_f4864062485a458c81609177514ba990-1"></a><span class="kn">import</span> <span class="nn">contextlib</span>
<a name="rest_code_f4864062485a458c81609177514ba990-2"></a>
<a name="rest_code_f4864062485a458c81609177514ba990-3"></a><span class="nd">@contextlib.contextmanager</span>
<a name="rest_code_f4864062485a458c81609177514ba990-4"></a><span class="k">def</span> <span class="nf">mycontextmanager</span><span class="p">():</span>
<a name="rest_code_f4864062485a458c81609177514ba990-5"></a>    <span class="k">print</span> <span class="s2">"__enter__"</span>
<a name="rest_code_f4864062485a458c81609177514ba990-6"></a>    <span class="k">try</span><span class="p">:</span>
<a name="rest_code_f4864062485a458c81609177514ba990-7"></a>        <span class="k">yield</span>
<a name="rest_code_f4864062485a458c81609177514ba990-8"></a>    <span class="k">finally</span><span class="p">:</span>
<a name="rest_code_f4864062485a458c81609177514ba990-9"></a>        <span class="k">print</span> <span class="s2">"__exit__"</span>
<a name="rest_code_f4864062485a458c81609177514ba990-10"></a>
<a name="rest_code_f4864062485a458c81609177514ba990-11"></a><span class="k">with</span> <span class="n">mycontextmanager</span><span class="p">()</span> <span class="k">as</span> <span class="n">context_var</span><span class="p">:</span>
<a name="rest_code_f4864062485a458c81609177514ba990-12"></a>    <span class="k">print</span> <span class="s1">'Doing work in the context'</span>
</pre>
<p>First we use the decorator <em>@contextmanager</em> to indicate to Python that the function will be a context manager.</p>
<p>Then, we do a <em>try/finally</em> (it is not automatic like with __enter__ and __exit__).</p>
<p>The word <em>yield</em> split the code in two parts:</p>
<ul class="simple">
<li>everything that is before  <em>yield</em> is similar to what we had above in  <em>__enter__</em>
</li>
<li>everything that is after is similar to <em>__exit__</em>
</li>
</ul>
<p>The content (the returned value) of <em>yield</em> is taken in the variable 'context_var' here defined with the key word <em>as</em>.</p>
</div>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/grep-aliases.html" class="u-url">Grep aliases</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Matthieu Choplin
            </span></p>
            <p class="dateline"><a href="posts/grep-aliases.html" rel="bookmark"><time class="published dt-published" datetime="2014-10-10T10:31:27+01:00" title="2014-10-10 10:31">2014-10-10 10:31</time></a></p>
                <p class="commentline">
        
    <a href="posts/grep-aliases.html#disqus_thread" data-disqus-identifier="cache/posts/grep-aliases.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>In .bashrc</p>
<pre class="code bash"><a name="rest_code_897d6439c11f43dbaee3ad67df4016aa-1"></a><span class="c1"># recursive search in files</span>
<a name="rest_code_897d6439c11f43dbaee3ad67df4016aa-2"></a>
<a name="rest_code_897d6439c11f43dbaee3ad67df4016aa-3"></a><span class="k">function</span> grp <span class="o">{</span>
<a name="rest_code_897d6439c11f43dbaee3ad67df4016aa-4"></a>
<a name="rest_code_897d6439c11f43dbaee3ad67df4016aa-5"></a>    <span class="nv">GREP_OPTIONS</span><span class="o">=</span><span class="s2">"-rI --color --exclude-dir=\.bzr --exclude-dir=\.git --exclude-dir=\.hg --exclude-dir=\.svn --exclude=tags </span><span class="nv">$GREP_OPTIONS</span><span class="s2">"</span> grep <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
<a name="rest_code_897d6439c11f43dbaee3ad67df4016aa-6"></a>
<a name="rest_code_897d6439c11f43dbaee3ad67df4016aa-7"></a><span class="o">}</span>
<a name="rest_code_897d6439c11f43dbaee3ad67df4016aa-8"></a>
<a name="rest_code_897d6439c11f43dbaee3ad67df4016aa-9"></a>
<a name="rest_code_897d6439c11f43dbaee3ad67df4016aa-10"></a>
<a name="rest_code_897d6439c11f43dbaee3ad67df4016aa-11"></a><span class="c1"># recursive search in Python source</span>
<a name="rest_code_897d6439c11f43dbaee3ad67df4016aa-12"></a>
<a name="rest_code_897d6439c11f43dbaee3ad67df4016aa-13"></a><span class="k">function</span> grpy <span class="o">{</span>
<a name="rest_code_897d6439c11f43dbaee3ad67df4016aa-14"></a>
<a name="rest_code_897d6439c11f43dbaee3ad67df4016aa-15"></a>  <span class="nv">GREP_OPTIONS</span><span class="o">=</span><span class="s2">"--exclude-dir=build --exclude-dir=dist --include=*.py </span><span class="nv">$GREP_OPTIONS</span><span class="s2">"</span> grp <span class="s2">"</span><span class="nv">$@</span><span class="s2">"</span>
<a name="rest_code_897d6439c11f43dbaee3ad67df4016aa-16"></a>
<a name="rest_code_897d6439c11f43dbaee3ad67df4016aa-17"></a><span class="o">}</span>
</pre>
<p>Use:</p>
<pre class="code bash"><a name="rest_code_e7270b6ff35e4481af161e3957913e2b-1"></a>$ grp WORD .
</pre>
<p>Or</p>
<pre class="code bash"><a name="rest_code_45a1ae9513d44347b4ec5b15758ccef0-1"></a>$ grpy to just search in python files
</pre>
<p>Then reload bashrc with:</p>
<pre class="code bash"><a name="rest_code_9d388d1fa2424990bc5c5b34e06a3078-1"></a>$ . ~/.bashrc
</pre>
<p>Thank you JB!! (<a class="reference external" href="http://tartley.com/">http://tartley.com/</a>)</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/monkeypatching-in-python.html" class="u-url">Monkeypatching in python</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Matthieu Choplin
            </span></p>
            <p class="dateline"><a href="posts/monkeypatching-in-python.html" rel="bookmark"><time class="published dt-published" datetime="2014-09-26T10:55:04+01:00" title="2014-09-26 10:55">2014-09-26 10:55</time></a></p>
                <p class="commentline">
        
    <a href="posts/monkeypatching-in-python.html#disqus_thread" data-disqus-identifier="cache/posts/monkeypatching-in-python.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>A MonkeyPatch is a piece of Python code which extends or modifies other code at runtime (typically at startup). MonkeyPatching would be the practice of writing, or running, a monkeypatch.</p>
<p>A simple example looks like this:</p>
<pre class="code python"><a name="rest_code_96a9983aa6f8485cb8c62027f153a803-1"></a><span class="kn">from</span> <span class="nn">SomeOtherProduct.SomeModule</span> <span class="kn">import</span> <span class="n">SomeClass</span>
<a name="rest_code_96a9983aa6f8485cb8c62027f153a803-2"></a><span class="k">def</span> <span class="nf">speak</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_96a9983aa6f8485cb8c62027f153a803-3"></a>    <span class="k">return</span> <span class="s2">"ook ook eee eee eee!"</span>
<a name="rest_code_96a9983aa6f8485cb8c62027f153a803-4"></a>
<a name="rest_code_96a9983aa6f8485cb8c62027f153a803-5"></a><span class="n">SomeClass</span><span class="o">.</span><span class="n">speak</span> <span class="o">=</span> <span class="n">speak</span>
</pre>
<p>In this example, if <em>SomeClass</em> did not already have a <em>speak()</em> method, it does now :-) If it had a speak() method before, <strong>the new code has replaced the old method definition</strong>.</p>
<p>Sources:</p>
<ul class="simple">
<li><a class="reference external" href="https://web.archive.org/web/20120730014107/">https://web.archive.org/web/20120730014107/</a></li>
<li><a class="reference external" href="http://wiki.zope.org/zope2/MonkeyPatch">http://wiki.zope.org/zope2/MonkeyPatch</a></li>
</ul>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/monitor-disk-usage-with-python.html" class="u-url">Monitor disk usage with python</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Matthieu Choplin
            </span></p>
            <p class="dateline"><a href="posts/monitor-disk-usage-with-python.html" rel="bookmark"><time class="published dt-published" datetime="2014-09-25T11:41:03+01:00" title="2014-09-25 11:41">2014-09-25 11:41</time></a></p>
                <p class="commentline">
        
    <a href="posts/monitor-disk-usage-with-python.html#disqus_thread" data-disqus-identifier="cache/posts/monitor-disk-usage-with-python.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>The module to use in python2 is <em>statvfs</em> imported from <em>os</em></p>
<pre class="code python"><a name="rest_code_2ab0a525928f4f41b130003178d3999c-1"></a><span class="kn">import</span> <span class="nn">os</span>
<a name="rest_code_2ab0a525928f4f41b130003178d3999c-2"></a><span class="n">statvfs</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">statvfs</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
<a name="rest_code_2ab0a525928f4f41b130003178d3999c-3"></a><span class="n">statvfs</span><span class="o">.</span><span class="n">f_frsize</span> <span class="o">*</span> <span class="n">statvfs</span><span class="o">.</span><span class="n">f_blocks</span>     <span class="c1"># Size of filesystem in bytes</span>
<a name="rest_code_2ab0a525928f4f41b130003178d3999c-4"></a><span class="n">statvfs</span><span class="o">.</span><span class="n">f_frsize</span> <span class="o">*</span> <span class="n">statvfs</span><span class="o">.</span><span class="n">f_bfree</span>      <span class="c1"># Actual number of free bytes</span>
<a name="rest_code_2ab0a525928f4f41b130003178d3999c-5"></a><span class="n">statvfs</span><span class="o">.</span><span class="n">f_frsize</span> <span class="o">*</span> <span class="n">statvfs</span><span class="o">.</span><span class="n">f_bavail</span>     <span class="c1"># Number of free bytes that ordinary users</span>
</pre>
<p>NB: it is deprecated in python3, the module to use will be <a class="reference external" href="https://docs.python.org/3.3/library/os.html#os.fstat">fstat</a> os.fstat</p>
<p>Source:</p>
<ul class="simple">
<li><a class="reference external" href="http://stackoverflow.com/questions/4260116/find-size-and-free-space-of-the-filesystem-containing-a-given-file">http://stackoverflow.com/questions/4260116/find-size-and-free-space-of-the-filesystem-containing-a-given-file</a></li>
</ul>
<p>Better usage:</p>
<ul class="simple">
<li><a class="reference external" href="http://blog.projectfondue.com/archives/2010/01/21/getting-an-early-warning-of-low-disk-space">http://blog.projectfondue.com/archives/2010/01/21/getting-an-early-warning-of-low-disk-space</a></li>
</ul>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/send-email-with-python.html" class="u-url">Send email with python</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Matthieu Choplin
            </span></p>
            <p class="dateline"><a href="posts/send-email-with-python.html" rel="bookmark"><time class="published dt-published" datetime="2014-09-25T11:20:32+01:00" title="2014-09-25 11:20">2014-09-25 11:20</time></a></p>
                <p class="commentline">
        
    <a href="posts/send-email-with-python.html#disqus_thread" data-disqus-identifier="cache/posts/send-email-with-python.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>This is a simple snippets for sending an email with a gmail smtp server.</p>
<p>If you want to send emails from localhost, you will have to first enable an smtp server.</p>
<p>So, the simplest is to use gmail smtp server:</p>
<pre class="code python"><a name="rest_code_22c061e0451f41218ad9115c720ffee0-1"></a><span class="kn">import</span> <span class="nn">smtplib</span>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-2"></a>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-3"></a><span class="c1"># define the method</span>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-4"></a><span class="k">def</span> <span class="nf">sendemail</span><span class="p">(</span><span class="n">from_addr</span><span class="p">,</span> <span class="n">to_addr_list</span><span class="p">,</span> <span class="n">cc_addr_list</span><span class="p">,</span>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-5"></a>              <span class="n">subject</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-6"></a>              <span class="n">login</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-7"></a>              <span class="n">smtpserver</span><span class="o">=</span><span class="s1">'smtp.gmail.com:587'</span><span class="p">):</span>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-8"></a>    <span class="n">header</span>  <span class="o">=</span> <span class="s1">'From: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">'</span> <span class="o">%</span> <span class="n">from_addr</span>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-9"></a>    <span class="n">header</span> <span class="o">+=</span> <span class="s1">'To: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">'</span> <span class="o">%</span> <span class="s1">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">to_addr_list</span><span class="p">)</span>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-10"></a>    <span class="n">header</span> <span class="o">+=</span> <span class="s1">'Cc: </span><span class="si">%s</span><span class="se">\n</span><span class="s1">'</span> <span class="o">%</span> <span class="s1">','</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cc_addr_list</span><span class="p">)</span>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-11"></a>    <span class="n">header</span> <span class="o">+=</span> <span class="s1">'Subject: </span><span class="si">%s</span><span class="se">\n\n</span><span class="s1">'</span> <span class="o">%</span> <span class="n">subject</span>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-12"></a>    <span class="n">message</span> <span class="o">=</span> <span class="n">header</span> <span class="o">+</span> <span class="n">message</span>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-13"></a>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-14"></a>    <span class="n">server</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="n">smtpserver</span><span class="p">)</span>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-15"></a>    <span class="n">server</span><span class="o">.</span><span class="n">starttls</span><span class="p">()</span>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-16"></a>    <span class="n">server</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">login</span><span class="p">,</span><span class="n">password</span><span class="p">)</span>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-17"></a>    <span class="n">problems</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">from_addr</span><span class="p">,</span> <span class="n">to_addr_list</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-18"></a>    <span class="n">server</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-19"></a>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-20"></a><span class="c1">#execute the method</span>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-21"></a><span class="n">sendemail</span><span class="p">(</span><span class="s1">'me@domain.com'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'you@yourdomain.com'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'andyou@yourdomain.com'</span><span class="p">],</span>
<a name="rest_code_22c061e0451f41218ad9115c720ffee0-22"></a>          <span class="s1">'test subject'</span><span class="p">,</span> <span class="s1">'test message'</span><span class="p">,</span> <span class="s1">'mylogin@gmail.com'</span><span class="p">,</span> <span class="s1">'mypassword'</span><span class="p">)</span>
</pre>
<p>Source:</p>
<ul class="simple">
<li><a class="reference external" href="http://rosettacode.org/wiki/Send_an_email#Python">http://rosettacode.org/wiki/Send_an_email#Python</a></li>
<li><a class="reference external" href="http://www.pythonforbeginners.com/code-snippets-source-code/using-python-to-send-email">http://www.pythonforbeginners.com/code-snippets-source-code/using-python-to-send-email</a></li>
</ul>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/version-control-etc-with-etckeeper.html" class="u-url">Version Control /etc with etckeeper</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Matthieu Choplin
            </span></p>
            <p class="dateline"><a href="posts/version-control-etc-with-etckeeper.html" rel="bookmark"><time class="published dt-published" datetime="2014-09-25T10:14:33+01:00" title="2014-09-25 10:14">2014-09-25 10:14</time></a></p>
                <p class="commentline">
        
    <a href="posts/version-control-etc-with-etckeeper.html#disqus_thread" data-disqus-identifier="cache/posts/version-control-etc-with-etckeeper.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>It is commonly agreed that keeping <em>/etc</em> under version control is a good practice.</p>
<p>Source:</p>
<ul class="simple">
<li><a class="reference external" href="https://help.ubuntu.com/10.04/serverguide/etckeeper.html">https://help.ubuntu.com/10.04/serverguide/etckeeper.html</a></li>
<li><a class="reference external" href="http://www.tldp.org/LDP/Linux-Filesystem-Hierarchy/html/etc.html">http://www.tldp.org/LDP/Linux-Filesystem-Hierarchy/html/etc.html</a></li>
</ul>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/sentry-installation.html" class="u-url">Sentry installation</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Matthieu Choplin
            </span></p>
            <p class="dateline"><a href="posts/sentry-installation.html" rel="bookmark"><time class="published dt-published" datetime="2014-09-24T22:03:47+01:00" title="2014-09-24 22:03">2014-09-24 22:03</time></a></p>
                <p class="commentline">
        
    <a href="posts/sentry-installation.html#disqus_thread" data-disqus-identifier="cache/posts/sentry-installation.html">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <div>
<p>Create a directory called sentry:</p>
<pre class="code bash"><a name="rest_code_c4be1f719ea04fe2ae649ddc0dbd2e39-1"></a><span class="c1"># mkdir /opt/sentry &amp;&amp; cd /opt/sentry</span>
</pre>
<p>Create a virtual environment and activate it:</p>
<pre class="code bash"><a name="rest_code_426fb25f0e97456794e5f5583743cfa1-1"></a><span class="c1"># virtualenv sentry &amp;&amp; source /opt/sentry/sentry/bin/activate</span>
</pre>
<p>Install Sentry:</p>
<pre class="code bash"><a name="rest_code_85bd5defa63b462a9b89d7a138153470-1"></a><span class="c1"># easy_install -UZ sentry[postgres]</span>
<a name="rest_code_85bd5defa63b462a9b89d7a138153470-2"></a><span class="c1"># easy_install -UZ sentry</span>
</pre>
<p>Initialize the conifguration</p>
<pre class="code bash"><a name="rest_code_5e887340fe184055abc11fc4d9a19eb0-1"></a><span class="c1"># sentry init /opt/sentry/sentry.conf.py</span>
</pre>
<p>In the configuration file /opt/sentry/sentry.conf.py, you are going to change:</p>
<ul class="simple">
<li>the database configuration such as:</li>
</ul>
<pre class="code python"><a name="rest_code_137566f1312747a883f186004549bcd7-1"></a><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
<a name="rest_code_137566f1312747a883f186004549bcd7-2"></a>  <span class="s1">'default'</span><span class="p">:</span> <span class="p">{</span>
<a name="rest_code_137566f1312747a883f186004549bcd7-3"></a>                <span class="s1">'ENGINE'</span><span class="p">:</span> <span class="s1">'django.db.backends.postgresql_psycopg2'</span><span class="p">,</span>
<a name="rest_code_137566f1312747a883f186004549bcd7-4"></a>                <span class="s1">'NAME'</span><span class="p">:</span> <span class="s1">'sentry'</span><span class="p">,</span>
<a name="rest_code_137566f1312747a883f186004549bcd7-5"></a>                <span class="s1">'USER'</span><span class="p">:</span> <span class="s1">'sentry'</span><span class="p">,</span>
<a name="rest_code_137566f1312747a883f186004549bcd7-6"></a>                <span class="s1">'PASSWORD'</span><span class="p">:</span> <span class="s1">'sentry'</span><span class="p">,</span>
<a name="rest_code_137566f1312747a883f186004549bcd7-7"></a>                <span class="s1">'HOST'</span><span class="p">:</span> <span class="s1">'localhost'</span><span class="p">,</span>
<a name="rest_code_137566f1312747a883f186004549bcd7-8"></a>                <span class="s1">'PORT'</span><span class="p">:</span> <span class="s1">''</span><span class="p">,</span>
<a name="rest_code_137566f1312747a883f186004549bcd7-9"></a>             <span class="p">}</span>
<a name="rest_code_137566f1312747a883f186004549bcd7-10"></a>           <span class="p">}</span>
</pre>
<ul class="simple">
<li>And the url:</li>
</ul>
<pre class="code python"><a name="rest_code_f301e855e0a7466b911261438ddc1214-1"></a><span class="n">SENTRY_URL_PREFIX</span> <span class="o">=</span> <span class="s1">'http://192.168.50.4:9000'</span> <span class="c1"># the ip address of the server</span>
</pre>
<p>Install postgresql</p>
<pre class="code bash"><a name="rest_code_d3922dd9b58f49b084e88ff27c489d4d-1"></a><span class="c1"># apt-get install postgresql-9.3</span>
</pre>
<p>Create a user for sentry:</p>
<pre class="code bash"><a name="rest_code_55a4a56e1d464caabe8d48d6ac8c5401-1"></a><span class="c1"># sudo su postgres</span>
<a name="rest_code_55a4a56e1d464caabe8d48d6ac8c5401-2"></a>$ createuser sentry
<a name="rest_code_55a4a56e1d464caabe8d48d6ac8c5401-3"></a>$ psql template1
<a name="rest_code_55a4a56e1d464caabe8d48d6ac8c5401-4"></a><span class="c1"># alter role sentry with password 'sentry';</span>
</pre>
<p>Create the database as postgres:</p>
<pre class="code bash"><a name="rest_code_e06962fb409a4c95ba80360351dd3280-1"></a><span class="c1"># createdb -E utf-8 sentry</span>
</pre>
<p>Create the initial schema using the upgrade command as root:</p>
<pre class="code bash"><a name="rest_code_307077b746cf46e59e4ebd0ec5a6f085-1"></a><span class="c1"># sentry --config=/opt/sentry/sentry.conf.py upgrade</span>
</pre>
<p>If you did not create the user on the first run, you can correct this by doing the following:</p>
<pre class="code bash"><a name="rest_code_6fe76bc458b843ba9a450b7827e1bb4b-1"></a><span class="c1"># sentry --config=/opt/sentry/sentry.conf.py createsuperuser</span>
<a name="rest_code_6fe76bc458b843ba9a450b7827e1bb4b-2"></a><span class="c1"># sentry --config=/opt/sentry/sentry.conf.py repair --owner=sentry</span>
</pre>
<p>You can start Sentry with:</p>
<pre class="code bash"><a name="rest_code_7912e1daa9244e8f921ed1a06f1a0190-1"></a><span class="c1"># sentry --config=/opt/sentry/sentry.conf.py start</span>
</pre>
</div>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="index-4.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="mattchoplin";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2016         <a href="mailto:choplin.mat@gmail.com">Matthieu Choplin</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-51792900-1', 'mattchoplin.com');
  ga('send', 'pageview');

</script><script src="assets/js/tipuesearch_set.js"></script><script src="assets/js/tipuesearch.js"></script><script>
    $(document).ready(function() {
        $('#tipue_search_input').tipuesearch({
            'mode': 'json',
            'contentLocation': '/assets/js/tipuesearch_content.json',
            'showUrl': false
        });
    });
</script>
</body>
</html>
